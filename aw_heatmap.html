<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Heatmap + bar chart: call types along the year in various neighborhoods</title>

    <!-- Load Bulma from CDN (consider saving it to repository instead) -->
    <!-- https://bulma.io/ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">

    <!-- Load Font Awesome 5 (free) icons -->
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
  </head>

  <body>

  <!-- Page header -->
  <!-- https://bulma.io/documentation/layout/hero/ -->
  <section class="hero is-primary is-bold">
    <div class="hero-body">
      <div class="container">
        <h1 class="title">Distribution of call types along the year</h1>
        <h2 class="subtitle">In various neighborhoods</h2>
      </div>
    </div>
  </section>
  <!-- End page header -->

  <!-- Page navigation -->
  <!-- https://bulma.io/documentation/components/navbar/ -->
  <nav class="navbar is-light" role="navigation" aria-label="main navigation">
    <div class="container">
      <div class="navbar-brand">

        <a class="navbar-item is-active" href="index.html">
          <span class="icon"><i class="fas fa-home"></i></span>
          <span>Home</span>
        </a>

        <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="main-menu">
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
      </div>

      <div id="main-menu" class="navbar-menu has-text-weight-medium">
        <!-- Left navbar items -->
        <div class="navbar-start">
          <a class="navbar-item" href="#data" title="Data">
            <span>Data</span>
          </a>

          <a class="navbar-item" href="#visualizations" title="Data">
            <span>Visualizations</span>
          </a>

        </div>
      </div>
    </div>
  </nav>
  <!-- End page navigation -->

  <section class="section">
    <div class="container">
      <!-- Begin page content -->
      <div class="content">
        <h1 class="title">
          Heatmap + bar chart
        </h1>
        <p class="subtitle">
          by Alex Wang
        </p>

        <p> </p>
        <h2 id="data">Data</h2>

        <ol>
          <li><strong>Call type group: </strong> Call types are divided into four main groups: Fire, Alarm, Potential Life Threatening and Non Life Threatening.</li>

          <li><strong>Response DtTm: </strong> Date and time this unit acknowledges the dispatch and records that the unit is en route to the location of the call.</li>

          <li><strong>Neighborhooods - Analysis Boundaries:</strong> Neighborhood District associated with this address, boundaries available here: https://data.sfgov.org/d/p5b7-5n3h</li>

          <li><strong>Number of Records: </strong> Count of records.</li>
        </ol>


        <h2 id="visualizations">Visualizations</h2>

        <h3> protorype by Tableau </h3>
        <img src="Prototype3.png" width="1440" height="900">


        <h3>D3 version</h3>
        <script src="https://d3js.org/d3.v5.min.js"></script>
        <div id="d3hm"></div>

        <script>
        // set svg size and plot margins
        const width = 960;
        const height = 500;

        const margin = {
          top: 50,
          bottom: 35,
          left: 60,
          right: 15
        };

        // append the svg object to the body of the page
        var svg = d3.select("#d3hm")
          .append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
          .append("g")
          .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

        var callTypeGroupName = ["Fire", "Potentially Life-Threatening", "Alarm", "Non Life-threatening", "Null"]
//        let CTG = data.map(row => row['Call_Type_Group']);

        let csv = "Fire_Department_Calls_for_Service05.csv";
        let yMap = new Map();
        let xMap = new Map();
        let nbhdMap = new Map();
        let currCount = 0;

        d3.csv(csv).then(function (data){
          var callTypeGroupArr = data.map(row => row['Call_Type_Group']);
          var monthNumberNameArr = data.map(row => row['Response_DtTm']);
          var neighborhoodsArr = data.map(row => row['Neighborhooods']);

          var ResponseDate = data.map(row => row['Response_DtTm']);
          i = 0;
          while(i < data.length) {
            typeName = callTypeGroupArr[i];
            monthNum = monthNumberNameArr[i];
            nbhd = neighborhoodsArr[i];

            if(typeName == "") {
              typeName = "NullType";
            }
            if(yMap.get(typeName)) {
              currCount = yMap.get(typeName);
        //        console.log(typeName + ": " + currCount + ";\n");

              currCount = currCount + 1;
              yMap.set(typeName, currCount);

            } else{
              yMap.set(typeName, 1);
        //      console.log("newly add: " + typeName + "..." + i);
            }
            i++;
    //        console.log(i);
          }

//          for(var i = 0; i++ < yMap.size; yMap.next())
//    console.log(yMap.hash(yMap.key()) + ' : ' + yMap.value());
// ["Fire", "Potentially Life-Threatening", "Alarm", "Non Life-threatening", "Null"]
        console.log("look at key:" + yMap.get('Fire'));
        console.log("look at key:" + yMap.get('Potentially Life-Threatening'));
        console.log("look at key:" + yMap.get('Alarm'));
        console.log("look at key:" + yMap.get('Non Life-threatening'));
        console.log("look at key:" + yMap.get('NullType'));







        });










        </script>
<!--TODO--><!--TODO--><!--TODO--><!--TODO--><!--TODO--><!--TODO--><!--TODO--><!--TODO--><!--TODO-->


        <h4>Instructions</h4>

        <p> The color of boxes in heatmap indicates the count of calling records, the x-axis of heatmap is the response date and time of SFFD's action, and y-axis is the call type. In the bar chart, each bar is a neighborhood and length is the count of calls. </p>

        <h4>Discussion</h4>
        <p> Firstly, in the heatmap, we could see the comparison between months that how the fire calls distributed, that there is no huge difference of number of calls among months. Also from the y-axis we could see the comparison between different types of calls, such as "potentially life-threatening" has much more number of call than that of other types.
        Moreover, in the barchart, we could see how are situation of neighborhoods on fire calls.</p>

        <h3> Planned interactivity</h3>
        <p> When clicking on specific box on heatmap, the relavent bar chart for that call type at that time for all neighborhoods would show.</p>

        <img src="hm100.png" width="1440" height="900">
        <img src="hm200.png" width="1440" height="900">
        <img src="hm300.png" width="1440" height="900">
        <img src="hm500.png" width="1440" height="900">
        <img src="hm600.png" width="1440" height="900">


        <h3> Connection to the project theme</h3>
        <p> This visualization explore several situation about works in SFFD.
          Firstly it shows how different call types take parts in all number of calls, so that we could know what kind of works do the SFFD do. For example, we would know that fire calls is not taking the major part of calls to SFFD.
        Also it shows the call type distributions along the year, and we could know that the calls to SFFD is not dependent on season or month or certain holidays, etc.
        Furthremore, if we switch between different data types, the specific number of calls for the same month on neightborhood would be different, so it could be potentially useful for SFFD to deploy different resource near different neighborhood, etc.</p>



  <!-- Mobile menu responsiveness -->
  <!-- https://bulma.io/documentation/components/navbar/ -->
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);

    if ($navbarBurgers.length > 0) {
      $navbarBurgers.forEach( el => {
        el.addEventListener('click', () => {
          const target = el.dataset.target;
          const $target = document.getElementById(target);
          el.classList.toggle('is-active');
          $target.classList.toggle('is-active');
        });
      });
    }
  });
  </script>
  <!-- End mobile menu responsiveness -->
  </body>

</html>
